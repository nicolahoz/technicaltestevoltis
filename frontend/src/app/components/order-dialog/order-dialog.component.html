<div class="flex gap-2" style="flex-direction: column;" *ngIf="formState$ | async as formState">
  <div class="flex gap-4 px-4" style="justify-content: space-between;">
    <div class="flex flex-col gap-1" style="flex-direction: column;">
      <label for="name">Cliente</label>
      <p-dropdown [options]="customers" emptyMessage="No hay clientes" [style]="{width: '14rem'}"
        [ngrxFormControlState]="formState.controls.customerId" optionValue="id" optionLabel="name"
        placeholder="Seleccionar cliente" class="w-full md:w-56" />
      <div *ngIf="formState.controls.customerId.isInvalid && formState.controls.customerId.isTouched"
        class="text-red-500 text-sm">
        <div *ngIf="formState.controls.customerId.errors?.required">Cliente es requerido</div>
      </div>
    </div>
    <div class="flex flex-col" style="flex-direction: column;">
      <label>&nbsp;</label>
      <p-button label="Agregar producto" icon="pi pi-plus" class="flex" (click)="addItem()" severity="secondary"
        [outlined]="true" />
    </div>
  </div>

  <div class="flex flex-col gap-2 overflow-y-auto" style="flex-direction: column; height: 50vh;">
    <ng-container *ngFor="let item of formState.controls.items.controls; let i = index; trackBy: trackById">
      <p-card class="rounded-xl shadow-md p-4">
        <div class="flex gap-6">
          <div class="flex gap-1" style="flex-direction: column;">
            <label for="name">Producto</label>
            <p-dropdown [options]="products" (onChange)="updateSubtotal($event.value, item.controls.quantity.value, i)" emptyMessage="No hay productos"
              [ngrxFormControlState]="item.controls.productId" ngrxDefaultViewAdapter optionValue="id" optionLabel="name"
              placeholder="Seleccionar producto" [style]="{width: '14rem'}" [appendTo]="'body'" />
          </div>
          <div class="flex gap-1" style="flex-direction: column;">
            <label for="quantity">Cantidad</label>
            <p-inputNumber [ngrxFormControlState]="item.controls.quantity" [showButtons]="true" (onInput)="updateSubtotal(item.controls.productId.value, $event.value, i)"
              buttonLayout="horizontal" spinnerMode="vertical" inputId="quantity"
              decrementButtonClass="p-button-secondary" incrementButtonClass="p-button-secondary"
              incrementButtonIcon="pi pi-plus" decrementButtonIcon="pi pi-minus" [size]="1" />
          </div>
          <div class="flex gap-1" style="flex-direction: column;">
            <label for="quantity">Subtotal</label>
            <p-inputNumber id="price" [readonly]="true" [ngrxFormControlState]="item.controls.subtotal" mode="currency" currency="USD"
              [useGrouping]="false" locale="en-US"></p-inputNumber>
          </div>
          <div class="flex" style="flex-direction: column; margin-left: auto;">
            <label>&nbsp;</label>
            <p-button icon="pi pi-trash" severity="danger" (click)="removeItem(i)" />
          </div>
        </div>
      </p-card>
    </ng-container>
  </div>

  <div class="flex justify-end gap-2 mt-4" style="justify-content: end;">
    <p-button (onClick)="cancel()" icon="pi pi-times" label="Cancelar" severity="secondary" />
    <p-button [disabled]="formState.isInvalid" (onClick)="save(formState.value)" icon="pi pi-check" label="Guardar" />
  </div>
</div>